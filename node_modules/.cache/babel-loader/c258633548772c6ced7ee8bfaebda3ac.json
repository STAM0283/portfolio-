{"ast":null,"code":"\"use strict\";\n\nvar transportHandler = require(\"./transport\"),\n    Transport = transportHandler.Transport,\n    MailComposer = require(\"mailcomposer\").MailComposer,\n    XOAuthGenerator = require(\"./xoauth\").XOAuthGenerator,\n    helpers = require(\"./helpers\"),\n    crypto = require(\"crypto\"),\n    os = require(\"os\"),\n    net = require(\"net\"),\n    packageData = require(\"../package.json\"),\n    publicAddress = require(\"public-address\");\n/*\n * Version constants\n */\n\n\nvar X_MAILER_NAME = \"Nodemailer\",\n    X_MAILER_HOMEPAGE = packageData.homepage;\nmodule.exports.X_MAILER_NAME = X_MAILER_NAME;\nmodule.exports.X_MAILER_HOMEPAGE = X_MAILER_HOMEPAGE; // Export createTransport method\n\nmodule.exports.createTransport = function (type, options) {\n  var transport = new Transport(type, options);\n\n  transport.sendMail = function (options, callback) {\n    options = options || {};\n    options.transport = options.transport || transport;\n    sendMail(options, callback);\n  };\n\n  return transport;\n}; //Export createXOAuthGenerator function\n\n\nmodule.exports.createXOAuthGenerator = function (options) {\n  return new XOAuthGenerator(options);\n}; // exports mail generator\n\n\nObject.defineProperty(module.exports, \"mail\", {\n  get: function () {\n    var transport = module.exports.createTransport(\"direct\");\n    return function (mailData) {\n      transport.sendMail(mailData);\n    };\n  }\n}); // Export Transport constructor\n\nmodule.exports.Transport = Transport; // Export Nodemailer constructor\n\nmodule.exports.Nodemailer = Nodemailer; // Export sendMail function (and the alias send_mail for legacy)\n\nmodule.exports.sendMail = module.exports.send_mail = sendMail;\n\nfunction sendMail(options, callback) {\n  var mailer = new Nodemailer(options);\n  mailer.validateSettings(function (err) {\n    if (err) {\n      // report validation error back to the client\n      return callback(err);\n    } else {\n      // try to send the e-mail message\n      mailer.sendMail(callback);\n    }\n  });\n  return mailer;\n}\n/**\n * <p>Generates a Nodemailer object which is the main 'hub' for managing the\n * send process</p>\n *\n * @constructor\n * @param {Object} options Message options object, see README for the complete list of possible options\n */\n\n\nfunction Nodemailer(options) {\n  var mailcomposerOptions = {};\n  this.options = options || {};\n  this.transport = this.options.transport;\n  mailcomposerOptions.identityString = X_MAILER_NAME + \" \" + packageData.version;\n\n  if (this.options.identityString) {\n    mailcomposerOptions.identityString = this.options.identityString;\n  }\n\n  if (this.options.encoding) {\n    mailcomposerOptions.encoding = this.options.encoding;\n  }\n\n  if (this.options.charset) {\n    mailcomposerOptions.charset = this.options.charset;\n  }\n\n  if (!!this.options.forceEmbeddedImages) {\n    mailcomposerOptions.forceEmbeddedImages = true;\n  }\n\n  this.mailcomposer = new MailComposer(mailcomposerOptions);\n\n  if (!this.transport) {\n    this.transport = this.getGlobalTransport();\n  }\n}\n/**\n * <p>Generates an user agent string for Nodemailer with homepage, version etc.</p>\n *\n * @return {String} user agent string for X-Mailer value\n */\n\n\nNodemailer.prototype.generateUserAgentString = function () {\n  var details = [];\n\n  if (packageData.version) {\n    details.push(packageData.version);\n  }\n\n  if (X_MAILER_HOMEPAGE) {\n    details.push(\"+\" + X_MAILER_HOMEPAGE);\n  }\n\n  if (this.transport) {\n    details.push((this.transport.transportType || \"\").toLowerCase() + (this.transport.version ? \"/\" + this.transport.version : \"\"));\n  }\n\n  return X_MAILER_NAME + (details.length ? \" (\" + details.join(\"; \") + \")\" : \"\");\n};\n/**\n * <p>Add support for legacy transport settings by checking for global\n * variables SMTP, sendmail and SES</p>\n *\n * @return {Object} {@link Transport} object\n */\n\n\nNodemailer.prototype.getGlobalTransport = function () {\n  if (this.options.SMTP) {\n    // cache the transport for SMTP as it is actually a connection pool\n    if (!this.options.SMTP._smtp_transport) {\n      this.options.SMTP._smtp_transport = new Transport(\"SMTP\", this.options.SMTP);\n    }\n\n    return this.options.SMTP._smtp_transport;\n  } else if (this.options.sendmail) {\n    return new Transport(\"sendmail\", this.options.sendmail);\n  } else if (this.options.SES) {\n    return new Transport(\"SES\", this.options.SES);\n  } else if (module.exports.SMTP) {\n    // cache the transport for SMTP as it is actually a connection pool\n    if (!module.exports._smtp_transport) {\n      module.exports._smtp_transport = new Transport(\"SMTP\", module.exports.SMTP);\n    }\n\n    return module.exports._smtp_transport;\n  } else if (module.exports.sendmail) {\n    return new Transport(\"sendmail\", module.exports.sendmail);\n  } else if (module.exports.SES) {\n    return new Transport(\"SES\", module.exports.SES);\n  }\n\n  return false;\n};\n/**\n * <p>Doesn't do much currently, if the future should link to transport\n * validation methods. For example in case of SES should check that AWS\n * keys are set up etc.</p>\n *\n * @param {Function} callback Callback function to run after validation\n */\n\n\nNodemailer.prototype.validateSettings = function (callback) {\n  var self = this;\n  process.nextTick(function () {\n    if (!self.transport || !self.transport.transport) {\n      return callback(new Error(\"No transport method defined\"));\n    } // transport.options.resolveHostname is set to true, resolve pulbic\n    // hostname for the machine and use self when generating Message-ID values\n    // or when communicating with SMTP\n\n\n    if (self.transport.options && self.transport.options.resolveHostname && !self.transport.options.name) {\n      return publicHostnameResolver.resolve(function (err, resolved) {\n        self.transport.options.name = self.resolveHostname(resolved ? resolved.hostname : self.options.name);\n        callback();\n      }.bind(self));\n    }\n\n    callback(null);\n  });\n};\n/**\n * <p>Send the e-mail message by using data from the original options object\n * and selected transport</p>\n *\n * @param {Function} callback Callback function to run when the e-mail has been sent (or it failed)\n */\n\n\nNodemailer.prototype.sendMail = function (callback) {\n  // compose the e-mail\n  this.generateMailObject(); // send the message using preselected transport method\n\n  this.transport.sendMailWithTransport(this.mailcomposer, callback);\n};\n/**\n * <p>Uses the data from the original options object to compose a mailcomposer\n * e-mail message that can be later streamed to the selected transport</p>\n */\n\n\nNodemailer.prototype.generateMailObject = function () {\n  // set envelope data, subject etc.\n  this.setGeneralOptions(); // set module defined headers (date, message-id, etc.)\n\n  this.setModuleHeaders(); // set user defined headers (if any)\n\n  this.setUserHeaders(); // set alternatives (if any)\n\n  this.setAlternatives(); // set attachments (if any)\n\n  this.setAttachments(); // setup dsn\n\n  if (this.options.dsn) {\n    this.mailcomposer.options.dsn = this.options.dsn;\n  }\n};\n/**\n * <p>Uses the general options (message sender and receiver, subject body, etc.)\n * to set mailcomposer properties. Includes support for legacy properties.</p>\n */\n\n\nNodemailer.prototype.setGeneralOptions = function () {\n  // generate plaintext if only HTML exists and generateTextFromHTML is true\n  if (!(this.options.text || this.options.body) && this.options.html && this.options.generateTextFromHTML) {\n    this.options.text = helpers.stripHTML(this.options.html);\n  }\n\n  var acceptedFields = [\"from\", \"sender\", \"to\", \"subject\", \"replyTo\", \"debug\", \"reply_to\", \"cc\", \"bcc\", \"body\", \"text\", \"html\", \"envelope\", \"inReplyTo\", \"references\"],\n      mailOptions = {},\n      keys = Object.keys(this.options),\n      key;\n\n  for (var i = 0, len = keys.length; i < len; i++) {\n    key = keys[i];\n\n    if (acceptedFields.indexOf(key) >= 0 && this.options[key]) {\n      mailOptions[key] = this.options[key];\n    }\n  }\n\n  if (this.options.debug) {\n    console.log(mailOptions);\n  }\n\n  this.mailcomposer.setMessageOption(mailOptions);\n};\n/**\n * <p>If the 'headers' property was set on the options, add the values to the\n * header of the e-mail message</p>\n */\n\n\nNodemailer.prototype.setUserHeaders = function () {\n  if (typeof this.options.headers != \"object\") {\n    return;\n  }\n\n  var keys = Object.keys(this.options.headers),\n      key;\n\n  for (var i = 0, len = keys.length; i < len; i++) {\n    key = keys[i];\n\n    if (this.options.headers[key]) {\n      this.mailcomposer.addHeader(key, this.options.headers[key], true);\n    }\n  }\n};\n/**\n * <p>Add some required headers to the message, such as Date: and Message-Id:</p>\n */\n\n\nNodemailer.prototype.setModuleHeaders = function () {\n  var messageId,\n      transportOptions = this.transport && this.transport.options && typeof this.transport.options == \"object\" && this.transport.options || {}; // Mailer name + version\n  // if xMailer is explicitly set to false, skip the X-Mailer header\n\n  if (transportOptions.xMailer !== false) {\n    this.mailcomposer.addHeader(\"X-Mailer\", transportOptions.xMailer || this.generateUserAgentString());\n  } // Date\n\n\n  if (this.options.date) {\n    this.mailcomposer.addHeader(\"Date\", this.options.date);\n  } else {\n    this.mailcomposer.addHeader(\"Date\", new Date().toUTCString());\n  } // Message ID\n\n\n  if (this.options.messageId) {\n    messageId = this.options.messageId;\n  } else if (this.options.messageId !== false) {\n    messageId = crypto.randomBytes(15).toString(\"hex\") + \"@\" + this.resolveHostname(this.options.name || transportOptions.name);\n  }\n\n  if (messageId) {\n    this.mailcomposer.addHeader(\"Message-Id\", \"<\" + messageId + \">\");\n    this.mailcomposer._messageId = messageId;\n  }\n};\n/**\n * <p>If attachment array is set on the options object, add these alternatives\n * to the mailcomposer object</p>\n */\n\n\nNodemailer.prototype.setAlternatives = function () {\n  var alternative;\n\n  if (!this.options.alternatives) {\n    return;\n  } // convert non array value to an array if needed\n\n\n  this.options.alternatives = [].concat(this.options.alternatives);\n\n  for (var i = 0, len = this.options.alternatives.length; i < len; i++) {\n    alternative = this.options.alternatives[i];\n    this.mailcomposer.addAlternative(alternative);\n  }\n};\n/**\n * <p>If attachment array is set on the options object, add these attachments\n * to the mailcomposer object</p>\n */\n\n\nNodemailer.prototype.setAttachments = function () {\n  var attachment;\n\n  if (!this.options.attachments) {\n    return;\n  } // convert non array value to an array if needed\n\n\n  this.options.attachments = [].concat(this.options.attachments);\n\n  for (var i = 0, len = this.options.attachments.length; i < len; i++) {\n    attachment = this.options.attachments[i];\n    attachment.userAgent = attachment.userAgent || this.generateUserAgentString();\n    this.mailcomposer.addAttachment(attachment);\n  }\n};\n/**\n * Resolves hostname, prefers given argument. If resolved\n * name is an IP address, \"localhost\" is used\n *\n * @param {String} [name] Preferred hostname\n * @return {String} Resolved hostname\n */\n\n\nNodemailer.prototype.resolveHostname = function (name) {\n  if (name === true) {\n    name = false;\n  }\n\n  if (!name || net.isIP(name.replace(/[\\[\\]]/g, \"\").trim())) {\n    name = os.hostname && os.hostname() || \"\";\n  }\n\n  if (!name || net.isIP(name.replace(/[\\[\\]]/g, \"\").trim())) {\n    name = \"localhost\";\n  }\n\n  return name.toLowerCase();\n};\n/**\n * Interface for resolving public hostname for the current machine\n * Resolves the hostname only once and uses the cached value later on\n */\n\n\nvar publicHostnameResolver = {\n  _callbacks: [],\n  _resolving: false,\n  _resolved: false,\n\n  /**\n   * Resolve hostname for the current machine\n   *\n   * @param {Function} callback Function with an error object and resolved data as arguments\n   */\n  resolve: function (callback) {\n    if (this._resolved) {\n      return callback(null, this._resolved);\n    }\n\n    this._callbacks.push(callback);\n\n    if (!this._resolving) {\n      this._startResolving();\n    }\n  },\n\n  /**\n   * Initiate hostname resolving\n   */\n  _startResolving: function () {\n    this._resolving = true;\n    publicAddress(function (err, data) {\n      this._resolving = false; // if the resolving failed, skip it\n\n      this._resolved = data || {}; // emit all queued callbacks\n\n      this._callbacks.forEach(function (callback) {\n        callback(null, this._resolved);\n      }.bind(this));\n    }.bind(this));\n  }\n};","map":{"version":3,"sources":["/home/wilder/Documents/portfolio/node_modules/express-mailer/node_modules/nodemailer/lib/nodemailer.js"],"names":["transportHandler","require","Transport","MailComposer","XOAuthGenerator","helpers","crypto","os","net","packageData","publicAddress","X_MAILER_NAME","X_MAILER_HOMEPAGE","homepage","module","exports","createTransport","type","options","transport","sendMail","callback","createXOAuthGenerator","Object","defineProperty","get","mailData","Nodemailer","send_mail","mailer","validateSettings","err","mailcomposerOptions","identityString","version","encoding","charset","forceEmbeddedImages","mailcomposer","getGlobalTransport","prototype","generateUserAgentString","details","push","transportType","toLowerCase","length","join","SMTP","_smtp_transport","sendmail","SES","self","process","nextTick","Error","resolveHostname","name","publicHostnameResolver","resolve","resolved","hostname","bind","generateMailObject","sendMailWithTransport","setGeneralOptions","setModuleHeaders","setUserHeaders","setAlternatives","setAttachments","dsn","text","body","html","generateTextFromHTML","stripHTML","acceptedFields","mailOptions","keys","key","i","len","indexOf","debug","console","log","setMessageOption","headers","addHeader","messageId","transportOptions","xMailer","date","Date","toUTCString","randomBytes","toString","_messageId","alternative","alternatives","concat","addAlternative","attachment","attachments","userAgent","addAttachment","isIP","replace","trim","_callbacks","_resolving","_resolved","_startResolving","data","forEach"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar transportHandler = require(\"./transport\"),\n    Transport = transportHandler.Transport,\n    MailComposer = require(\"mailcomposer\").MailComposer,\n    XOAuthGenerator = require(\"./xoauth\").XOAuthGenerator,\n    helpers = require(\"./helpers\"),\n    crypto = require(\"crypto\"),\n    os = require(\"os\"),\n    net = require(\"net\"),\n    packageData = require(\"../package.json\"),\n    publicAddress = require(\"public-address\");\n\n/*\n * Version constants\n */\nvar X_MAILER_NAME = \"Nodemailer\",\n    X_MAILER_HOMEPAGE = packageData.homepage;\n\nmodule.exports.X_MAILER_NAME = X_MAILER_NAME;\nmodule.exports.X_MAILER_HOMEPAGE = X_MAILER_HOMEPAGE;\n\n// Export createTransport method\nmodule.exports.createTransport = function(type, options){\n    var transport = new Transport(type, options);\n\n    transport.sendMail = function(options, callback){\n        options = options || {};\n        options.transport = options.transport || transport;\n        sendMail(options, callback);\n    };\n\n    return transport;\n};\n\n//Export createXOAuthGenerator function\nmodule.exports.createXOAuthGenerator = function(options){\n    return new XOAuthGenerator(options);\n};\n\n// exports mail generator\nObject.defineProperty(module.exports, \"mail\", {\n    get: function(){\n        var transport = module.exports.createTransport(\"direct\");\n        return function(mailData){\n            transport.sendMail(mailData);\n        };\n    }\n});\n\n// Export Transport constructor\nmodule.exports.Transport = Transport;\n\n// Export Nodemailer constructor\nmodule.exports.Nodemailer = Nodemailer;\n\n// Export sendMail function (and the alias send_mail for legacy)\nmodule.exports.sendMail = module.exports.send_mail = sendMail;\n\nfunction sendMail(options, callback){\n    var mailer = new Nodemailer(options);\n    mailer.validateSettings(function(err){\n        if(err){\n            // report validation error back to the client\n            return callback(err);\n        }else{\n            // try to send the e-mail message\n            mailer.sendMail(callback);\n        }\n    });\n\n    return mailer;\n}\n\n\n/**\n * <p>Generates a Nodemailer object which is the main 'hub' for managing the\n * send process</p>\n *\n * @constructor\n * @param {Object} options Message options object, see README for the complete list of possible options\n */\nfunction Nodemailer(options){\n    var mailcomposerOptions = {};\n\n    this.options = options || {};\n\n    this.transport = this.options.transport;\n\n    mailcomposerOptions.identityString = X_MAILER_NAME + \" \" + packageData.version;\n\n    if(this.options.identityString){\n        mailcomposerOptions.identityString = this.options.identityString;\n    }\n\n    if(this.options.encoding){\n        mailcomposerOptions.encoding = this.options.encoding;\n    }\n\n    if(this.options.charset){\n        mailcomposerOptions.charset = this.options.charset;\n    }\n\n    if(!!this.options.forceEmbeddedImages){\n        mailcomposerOptions.forceEmbeddedImages = true;\n    }\n\n    this.mailcomposer = new MailComposer(mailcomposerOptions);\n\n    if(!this.transport){\n        this.transport = this.getGlobalTransport();\n    }\n}\n\n/**\n * <p>Generates an user agent string for Nodemailer with homepage, version etc.</p>\n *\n * @return {String} user agent string for X-Mailer value\n */\nNodemailer.prototype.generateUserAgentString = function(){\n    var details = [];\n\n    if(packageData.version){\n        details.push(packageData.version);\n    }\n\n    if(X_MAILER_HOMEPAGE){\n        details.push(\"+\"+X_MAILER_HOMEPAGE);\n    }\n\n    if(this.transport){\n        details.push((this.transport.transportType || \"\").toLowerCase() +\n            (this.transport.version ? \"/\" + this.transport.version : \"\"));\n    }\n\n    return X_MAILER_NAME+ (details.length?\" (\"+details.join(\"; \")+\")\":\"\");\n};\n\n/**\n * <p>Add support for legacy transport settings by checking for global\n * variables SMTP, sendmail and SES</p>\n *\n * @return {Object} {@link Transport} object\n */\nNodemailer.prototype.getGlobalTransport = function(){\n    if(this.options.SMTP){\n        // cache the transport for SMTP as it is actually a connection pool\n        if(!this.options.SMTP._smtp_transport){\n            this.options.SMTP._smtp_transport = new Transport(\"SMTP\", this.options.SMTP);\n        }\n        return this.options.SMTP._smtp_transport;\n    }else if(this.options.sendmail){\n        return new Transport(\"sendmail\", this.options.sendmail);\n    }else if(this.options.SES){\n        return new Transport(\"SES\", this.options.SES);\n    }else if(module.exports.SMTP){\n        // cache the transport for SMTP as it is actually a connection pool\n        if(!module.exports._smtp_transport){\n            module.exports._smtp_transport = new Transport(\"SMTP\", module.exports.SMTP);\n        }\n        return module.exports._smtp_transport;\n    }else if(module.exports.sendmail){\n        return new Transport(\"sendmail\", module.exports.sendmail);\n    }else if(module.exports.SES){\n        return new Transport(\"SES\", module.exports.SES);\n    }\n    return false;\n};\n\n/**\n * <p>Doesn't do much currently, if the future should link to transport\n * validation methods. For example in case of SES should check that AWS\n * keys are set up etc.</p>\n *\n * @param {Function} callback Callback function to run after validation\n */\nNodemailer.prototype.validateSettings = function(callback){\n    var self = this;\n    process.nextTick(function(){\n        if(!self.transport || !self.transport.transport){\n            return callback(new Error(\"No transport method defined\"));\n        }\n\n        // transport.options.resolveHostname is set to true, resolve pulbic\n        // hostname for the machine and use self when generating Message-ID values\n        // or when communicating with SMTP\n        if(self.transport.options && self.transport.options.resolveHostname && !self.transport.options.name){\n            return publicHostnameResolver.resolve((function(err, resolved){\n                self.transport.options.name = self.resolveHostname(\n                    resolved ? resolved.hostname : self.options.name);\n                callback();\n            }).bind(self));\n        }\n\n        callback(null);\n    });\n};\n\n/**\n * <p>Send the e-mail message by using data from the original options object\n * and selected transport</p>\n *\n * @param {Function} callback Callback function to run when the e-mail has been sent (or it failed)\n */\nNodemailer.prototype.sendMail = function(callback){\n    // compose the e-mail\n    this.generateMailObject();\n    // send the message using preselected transport method\n    this.transport.sendMailWithTransport(this.mailcomposer, callback);\n};\n\n/**\n * <p>Uses the data from the original options object to compose a mailcomposer\n * e-mail message that can be later streamed to the selected transport</p>\n */\nNodemailer.prototype.generateMailObject = function(){\n\n    // set envelope data, subject etc.\n    this.setGeneralOptions();\n\n    // set module defined headers (date, message-id, etc.)\n    this.setModuleHeaders();\n\n    // set user defined headers (if any)\n    this.setUserHeaders();\n\n    // set alternatives (if any)\n    this.setAlternatives();\n\n    // set attachments (if any)\n    this.setAttachments();\n\n    // setup dsn\n    if(this.options.dsn){\n        this.mailcomposer.options.dsn = this.options.dsn;\n    }\n};\n\n/**\n * <p>Uses the general options (message sender and receiver, subject body, etc.)\n * to set mailcomposer properties. Includes support for legacy properties.</p>\n */\nNodemailer.prototype.setGeneralOptions = function(){\n\n    // generate plaintext if only HTML exists and generateTextFromHTML is true\n    if(!(this.options.text || this.options.body) && (this.options.html) &&\n      this.options.generateTextFromHTML){\n        this.options.text = helpers.stripHTML(this.options.html);\n    }\n\n    var acceptedFields = [\"from\", \"sender\", \"to\", \"subject\", \"replyTo\", \"debug\",\n                          \"reply_to\", \"cc\", \"bcc\", \"body\", \"text\", \"html\",\n                          \"envelope\", \"inReplyTo\", \"references\"],\n        mailOptions = {},\n        keys = Object.keys(this.options),\n        key;\n\n    for(var i=0, len=keys.length; i<len; i++){\n        key = keys[i];\n        if(acceptedFields.indexOf(key) >=0 && this.options[key]){\n            mailOptions[key] = this.options[key];\n        }\n    }\n\n    if(this.options.debug){\n        console.log(mailOptions);\n    }\n\n    this.mailcomposer.setMessageOption(mailOptions);\n};\n\n/**\n * <p>If the 'headers' property was set on the options, add the values to the\n * header of the e-mail message</p>\n */\nNodemailer.prototype.setUserHeaders = function(){\n    if(typeof this.options.headers != \"object\"){\n        return;\n    }\n    var keys = Object.keys(this.options.headers),\n        key;\n\n    for(var i=0, len=keys.length; i<len; i++){\n        key = keys[i];\n        if(this.options.headers[key]){\n            this.mailcomposer.addHeader(key, this.options.headers[key], true);\n        }\n    }\n};\n\n/**\n * <p>Add some required headers to the message, such as Date: and Message-Id:</p>\n */\nNodemailer.prototype.setModuleHeaders = function(){\n    var messageId,\n        transportOptions = this.transport &&\n            this.transport.options &&\n            typeof this.transport.options == \"object\" &&\n            this.transport.options || {};\n\n    // Mailer name + version\n    // if xMailer is explicitly set to false, skip the X-Mailer header\n    if(transportOptions.xMailer !== false){\n        this.mailcomposer.addHeader(\"X-Mailer\",\n            transportOptions.xMailer || this.generateUserAgentString());\n    }\n\n    // Date\n    if(this.options.date){\n        this.mailcomposer.addHeader(\"Date\", this.options.date);\n    }else{\n        this.mailcomposer.addHeader(\"Date\", new Date().toUTCString());\n    }\n\n    // Message ID\n    if(this.options.messageId){\n        messageId = this.options.messageId;\n    }else if(this.options.messageId !== false){\n        messageId = crypto.randomBytes(15).toString(\"hex\") +\"@\"+ this.resolveHostname(this.options.name || transportOptions.name);\n    }\n\n    if(messageId){\n        this.mailcomposer.addHeader(\"Message-Id\", \"<\"+messageId+\">\");\n        this.mailcomposer._messageId = messageId;\n    }\n\n};\n\n/**\n * <p>If attachment array is set on the options object, add these alternatives\n * to the mailcomposer object</p>\n */\nNodemailer.prototype.setAlternatives = function(){\n    var alternative;\n\n    if(!this.options.alternatives){\n        return;\n    }\n\n    // convert non array value to an array if needed\n    this.options.alternatives = [].concat(this.options.alternatives);\n\n    for(var i=0, len=this.options.alternatives.length; i<len; i++){\n        alternative = this.options.alternatives[i];\n        this.mailcomposer.addAlternative(alternative);\n    }\n};\n\n/**\n * <p>If attachment array is set on the options object, add these attachments\n * to the mailcomposer object</p>\n */\nNodemailer.prototype.setAttachments = function(){\n    var attachment;\n\n    if(!this.options.attachments){\n        return;\n    }\n\n    // convert non array value to an array if needed\n    this.options.attachments = [].concat(this.options.attachments);\n\n    for(var i=0, len=this.options.attachments.length; i<len; i++){\n        attachment = this.options.attachments[i];\n        attachment.userAgent = attachment.userAgent || this.generateUserAgentString();\n        this.mailcomposer.addAttachment(attachment);\n    }\n};\n\n/**\n * Resolves hostname, prefers given argument. If resolved\n * name is an IP address, \"localhost\" is used\n *\n * @param {String} [name] Preferred hostname\n * @return {String} Resolved hostname\n */\nNodemailer.prototype.resolveHostname = function(name){\n    if(name === true){\n        name = false;\n    }\n\n    if(!name || net.isIP(name.replace(/[\\[\\]]/g, \"\").trim())){\n        name = (os.hostname && os.hostname()) || \"\";\n    }\n\n    if(!name || net.isIP(name.replace(/[\\[\\]]/g, \"\").trim())){\n        name = \"localhost\";\n    }\n\n    return name.toLowerCase();\n};\n\n/**\n * Interface for resolving public hostname for the current machine\n * Resolves the hostname only once and uses the cached value later on\n */\nvar publicHostnameResolver = {\n\n    _callbacks: [],\n    _resolving: false,\n    _resolved: false,\n\n    /**\n     * Resolve hostname for the current machine\n     *\n     * @param {Function} callback Function with an error object and resolved data as arguments\n     */\n    resolve: function(callback){\n        if(this._resolved){\n            return callback(null, this._resolved);\n        }\n\n        this._callbacks.push(callback);\n\n        if(!this._resolving){\n            this._startResolving();\n        }\n    },\n\n    /**\n     * Initiate hostname resolving\n     */\n    _startResolving: function(){\n        this._resolving = true;\n\n        publicAddress((function(err, data){\n            this._resolving = false;\n\n            // if the resolving failed, skip it\n            this._resolved = data || {};\n\n            // emit all queued callbacks\n            this._callbacks.forEach((function(callback){\n                callback(null, this._resolved);\n            }).bind(this));\n        }).bind(this));\n    }\n};\n"]},"metadata":{},"sourceType":"script"}